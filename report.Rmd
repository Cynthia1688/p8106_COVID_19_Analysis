---
title: "Report"
date: "2024-03-21"
output: 
  pdf_document:
    latex_engine: xelatex
    toc: yes
    toc_depth: 3
  header-includes:
    -\usepackage{fancyhdr}
    -\usepackage{lipsum}
    -\pagestyle{fancy}
    -\fancyhead[R]{\thepage}
    -\fancypagestyle{plain}{\pagestyle{fancy}}
---
```{r setup}
knitr::opts_chunk$set(
  collapse = TRUE, 
  warning = FALSE, 
  message = FALSE,
  fig.dim = c(10, 5),
  fig.format = "png")
```

# Load Data and Package

```{r}
library(tidyverse)
library(caret)
load("./Data/recovery.RData")
dat = dat |>
  mutate(across(c(study, gender,hypertension,diabetes,vaccine,severity), ~factor(.))) 
dat |> skimr::skim()
```

## MARS

```{r}

# matrix of predictors 
x <- model.matrix(recovery_time ~ ., dat |> select(-id))[, -1]
# vector of response
y <- dat$recovery_time

mars_grid <- expand.grid(degree = 1:3, 
                         nprune = 2:15)

set.seed(2)
ctrl1 <- trainControl(method = "cv", number = 10)

mars.fit <- train(x, y,
                  method = "earth",
                  tuneGrid = mars_grid,
                  trControl = ctrl1)


ggplot(mars.fit)


mars.fit$bestTune

coef(mars.fit$finalModel) 
```

## Lasso

```{r}
set.seed(2)
lasso.fit <- train(x, y,
                   method = "glmnet",
                   tuneGrid = expand.grid(alpha = 1, 
                                          lambda = exp(seq(3, -5, length = 100))),
                   trControl = ctrl1)
plot(lasso.fit, xTrans = log)

lasso.fit$bestTune

# coefficients in the final model
coef(lasso.fit$finalModel, lasso.fit$bestTune$lambda)
```

